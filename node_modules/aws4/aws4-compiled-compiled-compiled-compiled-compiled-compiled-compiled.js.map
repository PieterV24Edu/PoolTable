{"version":3,"sources":["aws4-compiled-compiled-compiled-compiled-compiled-compiled.js"],"names":[],"mappings":"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","file":"aws4-compiled-compiled-compiled-compiled-compiled-compiled-compiled.js","sourcesContent":["'use strict';\n\nvar aws4 = exports,\n    url = require('url'),\n    querystring = require('querystring'),\n    crypto = require('crypto'),\n    lru = require('./lru'),\n    credentialsCache = lru(1000);\n\n// http://docs.amazonwebservices.com/general/latest/gr/signature-version-4.html\n\nfunction hmac(key, string, encoding) {\n  return crypto.createHmac('sha256', key).update(string, 'utf8').digest(encoding);\n}\n\nfunction hash(string, encoding) {\n  return crypto.createHash('sha256').update(string, 'utf8').digest(encoding);\n}\n\n// This function assumes the string has already been percent encoded\nfunction encodeRfc3986(urlEncodedString) {\n  return urlEncodedString.replace(/[!'()*]/g, function (c) {\n    return '%' + c.charCodeAt(0).toString(16).toUpperCase();\n  });\n}\n\n// request: { path | body, [host], [method], [headers], [service], [region] }\n// credentials: { accessKeyId, secretAccessKey, [sessionToken] }\nfunction RequestSigner(request, credentials) {\n\n  if (typeof request === 'string') request = url.parse(request);\n\n  var headers = request.headers = request.headers || {},\n      hostParts = this.matchHost(request.hostname || request.host || headers.Host || headers.host);\n\n  this.request = request;\n  this.credentials = credentials || this.defaultCredentials();\n\n  this.service = request.service || hostParts[0] || '';\n  this.region = request.region || hostParts[1] || 'us-east-1';\n\n  // SES uses a different domain from the service name\n  if (this.service === 'email') this.service = 'ses';\n\n  if (!request.method && request.body) request.method = 'POST';\n\n  if (!headers.Host && !headers.host) {\n    headers.Host = request.hostname || request.host || this.createHost();\n\n    // If a port is specified explicitly, use it as is\n    if (request.port) headers.Host += ':' + request.port;\n  }\n  if (!request.hostname && !request.host) request.hostname = headers.Host || headers.host;\n}\n\nRequestSigner.prototype.matchHost = function (host) {\n  var match = (host || '').match(/([^\\.]+)\\.(?:([^\\.]*)\\.)?amazonaws\\.com$/);\n  var hostParts = (match || []).slice(1, 3);\n\n  // ES's hostParts are sometimes the other way round, if the value that is expected\n  // to be region equals ‘es’ switch them back\n  // e.g. search-cluster-name-aaaa00aaaa0aaa0aaaaaaa0aaa.us-east-1.es.amazonaws.com\n  if (hostParts[1] === 'es') hostParts = hostParts.reverse();\n\n  return hostParts;\n};\n\n// http://docs.aws.amazon.com/general/latest/gr/rande.html\nRequestSigner.prototype.isSingleRegion = function () {\n  // Special case for S3 and SimpleDB in us-east-1\n  if (['s3', 'sdb'].indexOf(this.service) >= 0 && this.region === 'us-east-1') return true;\n\n  return ['cloudfront', 'ls', 'route53', 'iam', 'importexport', 'sts'].indexOf(this.service) >= 0;\n};\n\nRequestSigner.prototype.createHost = function () {\n  var region = this.isSingleRegion() ? '' : (this.service === 's3' && this.region !== 'us-east-1' ? '-' : '.') + this.region,\n      service = this.service === 'ses' ? 'email' : this.service;\n  return service + region + '.amazonaws.com';\n};\n\nRequestSigner.prototype.prepareRequest = function () {\n  this.parsePath();\n\n  var request = this.request,\n      headers = request.headers,\n      query;\n\n  if (request.signQuery) {\n\n    this.parsedPath.query = query = this.parsedPath.query || {};\n\n    if (this.credentials.sessionToken) query['X-Amz-Security-Token'] = this.credentials.sessionToken;\n\n    if (this.service === 's3' && !query['X-Amz-Expires']) query['X-Amz-Expires'] = 86400;\n\n    if (query['X-Amz-Date']) this.datetime = query['X-Amz-Date'];else query['X-Amz-Date'] = this.getDateTime();\n\n    query['X-Amz-Algorithm'] = 'AWS4-HMAC-SHA256';\n    query['X-Amz-Credential'] = this.credentials.accessKeyId + '/' + this.credentialString();\n    query['X-Amz-SignedHeaders'] = this.signedHeaders();\n  } else {\n\n    if (!request.doNotModifyHeaders) {\n      if (request.body && !headers['Content-Type'] && !headers['content-type']) headers['Content-Type'] = 'application/x-www-form-urlencoded; charset=utf-8';\n\n      if (request.body && !headers['Content-Length'] && !headers['content-length']) headers['Content-Length'] = Buffer.byteLength(request.body);\n\n      if (this.credentials.sessionToken) headers['X-Amz-Security-Token'] = this.credentials.sessionToken;\n\n      if (this.service === 's3') headers['X-Amz-Content-Sha256'] = hash(this.request.body || '', 'hex');\n\n      if (headers['X-Amz-Date']) this.datetime = headers['X-Amz-Date'];else headers['X-Amz-Date'] = this.getDateTime();\n    }\n\n    delete headers.Authorization;\n    delete headers.authorization;\n  }\n};\n\nRequestSigner.prototype.sign = function () {\n  if (!this.parsedPath) this.prepareRequest();\n\n  if (this.request.signQuery) {\n    this.parsedPath.query['X-Amz-Signature'] = this.signature();\n  } else {\n    this.request.headers.Authorization = this.authHeader();\n  }\n\n  this.request.path = this.formatPath();\n\n  return this.request;\n};\n\nRequestSigner.prototype.getDateTime = function () {\n  if (!this.datetime) {\n    var headers = this.request.headers,\n        date = new Date(headers.Date || headers.date || new Date());\n\n    this.datetime = date.toISOString().replace(/[:\\-]|\\.\\d{3}/g, '');\n  }\n  return this.datetime;\n};\n\nRequestSigner.prototype.getDate = function () {\n  return this.getDateTime().substr(0, 8);\n};\n\nRequestSigner.prototype.authHeader = function () {\n  return ['AWS4-HMAC-SHA256 Credential=' + this.credentials.accessKeyId + '/' + this.credentialString(), 'SignedHeaders=' + this.signedHeaders(), 'Signature=' + this.signature()].join(', ');\n};\n\nRequestSigner.prototype.signature = function () {\n  var date = this.getDate(),\n      cacheKey = [this.credentials.secretAccessKey, date, this.region, this.service].join(),\n      kDate,\n      kRegion,\n      kService,\n      kCredentials = credentialsCache.get(cacheKey);\n  if (!kCredentials) {\n    kDate = hmac('AWS4' + this.credentials.secretAccessKey, date);\n    kRegion = hmac(kDate, this.region);\n    kService = hmac(kRegion, this.service);\n    kCredentials = hmac(kService, 'aws4_request');\n    credentialsCache.set(cacheKey, kCredentials);\n  }\n  return hmac(kCredentials, this.stringToSign(), 'hex');\n};\n\nRequestSigner.prototype.stringToSign = function () {\n  return ['AWS4-HMAC-SHA256', this.getDateTime(), this.credentialString(), hash(this.canonicalString(), 'hex')].join('\\n');\n};\n\nRequestSigner.prototype.canonicalString = function () {\n  if (!this.parsedPath) this.prepareRequest();\n\n  var pathStr = this.parsedPath.path,\n      query = this.parsedPath.query,\n      queryStr = '',\n      normalizePath = this.service !== 's3',\n      decodePath = this.service === 's3' || this.request.doNotEncodePath,\n      decodeSlashesInPath = this.service === 's3',\n      firstValOnly = this.service === 's3',\n      bodyHash = this.service === 's3' && this.request.signQuery ? 'UNSIGNED-PAYLOAD' : hash(this.request.body || '', 'hex');\n\n  if (query) {\n    queryStr = encodeRfc3986(querystring.stringify(Object.keys(query).sort().reduce(function (obj, key) {\n      if (!key) return obj;\n      obj[key] = !Array.isArray(query[key]) ? query[key] : firstValOnly ? query[key][0] : query[key].slice().sort();\n      return obj;\n    }, {})));\n  }\n  if (pathStr !== '/') {\n    if (normalizePath) pathStr = pathStr.replace(/\\/{2,}/g, '/');\n    pathStr = pathStr.split('/').reduce(function (path, piece) {\n      if (normalizePath && piece === '..') {\n        path.pop();\n      } else if (!normalizePath || piece !== '.') {\n        if (decodePath) piece = querystring.unescape(piece);\n        path.push(encodeRfc3986(querystring.escape(piece)));\n      }\n      return path;\n    }, []).join('/');\n    if (pathStr[0] !== '/') pathStr = '/' + pathStr;\n    if (decodeSlashesInPath) pathStr = pathStr.replace(/%2F/g, '/');\n  }\n\n  return [this.request.method || 'GET', pathStr, queryStr, this.canonicalHeaders() + '\\n', this.signedHeaders(), bodyHash].join('\\n');\n};\n\nRequestSigner.prototype.canonicalHeaders = function () {\n  var headers = this.request.headers;\n  function trimAll(header) {\n    return header.toString().trim().replace(/\\s+/g, ' ');\n  }\n  return Object.keys(headers).sort(function (a, b) {\n    return a.toLowerCase() < b.toLowerCase() ? -1 : 1;\n  }).map(function (key) {\n    return key.toLowerCase() + ':' + trimAll(headers[key]);\n  }).join('\\n');\n};\n\nRequestSigner.prototype.signedHeaders = function () {\n  return Object.keys(this.request.headers).map(function (key) {\n    return key.toLowerCase();\n  }).sort().join(';');\n};\n\nRequestSigner.prototype.credentialString = function () {\n  return [this.getDate(), this.region, this.service, 'aws4_request'].join('/');\n};\n\nRequestSigner.prototype.defaultCredentials = function () {\n  var env = process.env;\n  return {\n    accessKeyId: env.AWS_ACCESS_KEY_ID || env.AWS_ACCESS_KEY,\n    secretAccessKey: env.AWS_SECRET_ACCESS_KEY || env.AWS_SECRET_KEY,\n    sessionToken: env.AWS_SESSION_TOKEN\n  };\n};\n\nRequestSigner.prototype.parsePath = function () {\n  var path = this.request.path || '/',\n      queryIx = path.indexOf('?'),\n      query = null;\n\n  if (queryIx >= 0) {\n    query = querystring.parse(path.slice(queryIx + 1));\n    path = path.slice(0, queryIx);\n  }\n\n  // S3 doesn't always encode characters > 127 correctly and\n  // all services don't encode characters > 255 correctly\n  // So if there are non-reserved chars (and it's not already all % encoded), just encode them all\n  if (/[^0-9A-Za-z!'()*\\-._~%/]/.test(path)) {\n    path = path.split('/').map(function (piece) {\n      return querystring.escape(querystring.unescape(piece));\n    }).join('/');\n  }\n\n  this.parsedPath = {\n    path: path,\n    query: query\n  };\n};\n\nRequestSigner.prototype.formatPath = function () {\n  var path = this.parsedPath.path,\n      query = this.parsedPath.query;\n\n  if (!query) return path;\n\n  // Services don't support empty query string keys\n  if (query[''] != null) delete query[''];\n\n  return path + '?' + encodeRfc3986(querystring.stringify(query));\n};\n\naws4.RequestSigner = RequestSigner;\n\naws4.sign = function (request, credentials) {\n  return new RequestSigner(request, credentials).sign();\n};\n\n//# sourceMappingURL=aws4-compiled.js.map\n\n//# sourceMappingURL=aws4-compiled-compiled.js.map\n\n//# sourceMappingURL=aws4-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=aws4-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=aws4-compiled-compiled-compiled-compiled-compiled.js.map\n\n//# sourceMappingURL=aws4-compiled-compiled-compiled-compiled-compiled-compiled.js.map"]}